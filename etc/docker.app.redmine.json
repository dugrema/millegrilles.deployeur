{
  "registries": [
    "docker.maceroc.com",
    "dugremat"
  ],
  "images": {
    "shared.postgres": {
      "registries": [
        ""
      ],
      "image": "postgres",
      "version": "12.3"
    },
    "redmine": {
      "image": "mg_redmine",
      "version": "4.1_0"
    }
  },
  "subdomain": "redmine",
  "dependances": [
    {
      "image": "shared.postgres",
      "scripts": [
        {
          "commande": "psql -h postgres -U postgres -f /scripts/psql.redmine_init.sql"
        }
      ]
    },
    {
      "image": "redmine",
      "config": {
        "name": "redmine",
        "env": [
          "WEB_CERT=/run/secrets/webcert.pem",
          "WEB_KEY=/run/secrets/webkey.pem"
        ],
        "mounts": [
          "${MOUNTS}/redmine/files:/usr/src/redmine/files:rw"
        ],
        "constraints": [
          "node.labels.millegrilles.prive == true"
        ],
        "configs": [
          {
            "name": "pki.web.cert;pki.web_protege.cert",
            "filename": "/run/secrets/webcert.pem"
          },
          {
            "name": "pki.millegrille.cert",
            "filename": "/run/secrets/millegrille.cert.pem"
          }
        ],
        "secrets": [
          {
            "name": "pki.web.key;pki.web_protege.key",
            "filename": "webkey.pem"
          }
        ],
        "container_labels": {
          "ipv6.mapper.network": "mg_ipv6"
        },
        "networks": [
          {
            "target": "mg_${IDMG}_net",
            "aliases": ["redmine"]
          }
        ],
        "labels": {
          "millegrille": "${IDMG}"
        },
        "resources": {
          "cpu_limit": 1000000000,
          "mem_limit": 209715200
        },
        "mode": {
          "mode": "replicated",
          "replicas": 1
        }
      }
    }
  ]
}
