{
  "Name": "maitredescles-python",
  "TaskTemplate": {
    "ContainerSpec": {
      "Image": "${mg-python}",
      "Args": [
        "demarrer_domaine.py",
        "--info"
      ],
      "Hostname": "maitredescles-python.local",
      "Env": [
        "MG_NOM_MILLEGRILLE=${NOM_MILLEGRILLE}",
        "MG_DOMAINES_JSON=/opt/millegrilles/dist/domaines_MaitreDesCles.json",
        "MG_CONFIG_JSON=/run/secrets/mg.maitredescles.json",
        "MG_MONGO_USERNAME=maitredescles",
        "MG_MQ_HOST=mq",
        "MG_MQ_PORT=5673",
        "MG_MQ_SSL=on",
        "MG_MQ_AUTH_CERT=on",
        "MG_MQ_CERTFILE=/run/secrets/pki.millegrilles.ssl.cert",
        "MG_MQ_KEYFILE=/run/secrets/pki.millegrilles.ssl.key",
        "MG_MQ_CA_CERTS=/run/secrets/pki.millegrilles.ssl.CAchain",
        "MG_MONGO_HOST=mongo",
        "MG_MONGO_SSL=on",
        "MG_MONGO_SSL_CERTFILE=/run/secrets/pki.millegrilles.ssl.key_cert",
        "MG_MONGO_SSL_CA_CERTS=/run/secrets/pki.millegrilles.ssl.CAchain"
      ],
      "Mounts": [
        {
          "Type": "volume",
          "Source": "maitredescles_secrets",
          "Target": "/opt/millegrilles/dist/secure/maitredescles"
        },
        {
          "Type": "volume",
          "Source": "pki_workdir",
          "Target": "/opt/millegrilles/dist/secure/pki"
        }
      ],
      "Secrets": [
        {
          "SecretName": "pki.maitrecles.key",
          "File": {
            "Name": "pki.millegrilles.ssl.key",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "SecretName": "pki.maitrecles.key_cert",
          "File": {
            "Name": "pki.millegrilles.ssl.key_cert",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "SecretName": "pki.millegrille.key",
          "File": {
            "Name": "pki.ca.millegrille.key",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "SecretName": "pki.racine.key",
          "File": {
            "Name": "pki.ca.root.key",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "SecretName": "pki.ca.passwords",
          "File": {
            "Name": "pki.ca.passwords",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "SecretName": "passwd.maitrecles.json",
          "File": {
            "Name": "mg.maitredescles.json",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }
      ],
      "Configs": [
        {
          "ConfigName": "pki.maitrecles.cert",
          "File": {
            "Name": "/run/secrets/pki.millegrilles.ssl.cert",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "ConfigName": "pki.millegrille.fullchain",
          "File": {
            "Name": "/run/secrets/pki.millegrilles.ssl.CAchain",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "ConfigName": "pki.millegrille.cert",
          "File": {
            "Name": "/run/secrets/pki.ca.millegrille.cert",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "ConfigName": "pki.racine.cert",
          "File": {
            "Name": "/run/secrets/pki.ca.root.cert",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }
      ]
    },
    "Placement": {
      "Constraints": [
        "node.labels.millegrilles.maitredescles == true"
      ]
    },
    "Resources": {
      "Limits": {
        "NanoCPUs": 500000000,
        "MemoryBytes": 104857600
      }
    },
    "RestartPolicy": {
      "Condition": "on-failure",
      "Delay": 90000000000
    },
    "Mode": {
      "Replicated": {
        "Replicas": 1
      }
    },
    "Networks": [
        {
          "Target": "mg_${NOM_MILLEGRILLE}_net"
        }
    ]
  },
  "Labels": {
    "millegrille": "${NOM_MILLEGRILLE}"
  }
}
