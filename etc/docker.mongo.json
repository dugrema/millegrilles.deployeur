{
  "name": "mongo",
  "args": [
    "mongod",
    "--replSet", "rs0",
    "--sslMode", "requireSSL",
    "--sslPEMKeyFile", "/run/secrets/pki.millegrilles.ssl.key_cert",
    "--sslCAFile", "/run/secrets/pki.millegrilles.ssl.CAchain"
  ],
  "env": [
    "MONGO_INITDB_ROOT_USERNAME=${MONGO_INITDB_ROOT_USERNAME}",
    "MONGO_INITDB_ROOT_PASSWORD_FILE=/run/secrets/mongo.root.password"
  ],
  "mounts": [
    "${MOUNTS}/mongo/data:/data/db:rw",
    "${MOUNTS}/mongo/scripts:/opt/mongodb/scripts:rw"
  ],
  "constraints": [
    "node.labels.millegrilles.database == true"
  ],
  "configs": [
    {
      "name": "pki.mongo.cert",
      "filename": "/run/secrets/pki.millegrilles.ssl.cert"
    },
    {
      "name": "pki.millegrille.cert",
      "filename": "/run/secrets/pki.millegrilles.ssl.CAchain"
    }
  ],
  "secrets": [
    {
      "name": "pki.mongo.key_cert",
      "filename": "pki.millegrilles.ssl.key_cert"
    },
    {
      "name": "passwd.mongo.root",
      "filename": "mongo.root.password"
    },
    {
      "name": "passwd.mongo.scriptinit",
      "filename": "mongo.accounts.js"
    }
  ],
  "endpoint_spec": {
    "mode": "vip",
    "ports": [
      {
        "published_port": 8443,
        "target_port": 8443,
        "protocol": "tcp",
        "publish_mode": "host"
      },
      {
        "published_port": 5673,
        "target_port": 5673,
        "protocol": "tcp",
        "publish_mode": "host"
      }
    ]
  },
  "container_labels": {
    "ipv6.mapper.network": "mg_ipv6"
  },
  "networks": [{
    "target": "mg_${IDMG}_net",
    "aliases": ["mongo"]
  }],
  "labels": {
    "millegrille": "${IDMG}"
  },
  "resources": {
    "cpu_limit": 1000000000,
    "mem_limit": 1073741824
  },
  "restart_policy": {
    "condition": "any",
    "delay": 30000000000
  },
  "mode": {
    "mode": "global"
  }
}