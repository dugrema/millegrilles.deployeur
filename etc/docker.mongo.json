{
  "Name": "mongo",
  "TaskTemplate": {
    "ContainerSpec": {
      "Image": "${mongo}",
      "Args": [
        "mongod",
        "--replSet", "rs0",
        "--sslMode", "requireSSL",
        "--sslPEMKeyFile", "/run/secrets/pki.millegrilles.ssl.key_cert",
        "--sslCAFile", "/run/secrets/pki.millegrilles.ssl.CAchain"
      ],
      "Hostname": "mongo.local",
      "Env": [
        "MONGO_INITDB_ROOT_USERNAME=${MONGO_INITDB_ROOT_USERNAME}",
        "MONGO_INITDB_ROOT_PASSWORD_FILE=/run/secrets/mongo.root.password"
      ],
      "Mounts": [
        {
          "Type": "bind",
          "Source": "${MOUNTS}/mongo/data",
          "Target": "/data/db"
        },
        {
          "Type": "bind",
          "Source": "${MOUNTS}/mongo/scripts",
          "Target": "/opt/mongodb/scripts"
        }
      ],
      "Secrets": [
        {
          "SecretName": "pki.mongo.key_cert",
          "File": {
            "Name": "pki.millegrilles.ssl.key_cert",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        },
        {
          "SecretName": "passwd.mongo.root",
          "File": {
            "Name": "mongo.root.password",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        },
        {
          "SecretName": "passwd.mongo.scriptinit",
          "File": {
            "Name": "mongo.accounts.js",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }
      ],
      "Configs": [
        {
          "ConfigName": "pki.mongo.cert",
          "File": {
            "Name": "/run/secrets/pki.millegrilles.ssl.cert",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        },
        {
          "ConfigName": "pki.millegrille.fullchain",
          "File": {
            "Name": "/run/secrets/pki.millegrilles.ssl.CAchain",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }
      ]
    },
    "Placement": {
      "Constraints": [
        "node.labels.netzone.private == true",
        "node.labels.millegrilles.database == true"
      ]
    },
    "Resources": {
      "Limits": {
        "NanoCPUs": 1000000000,
        "MemoryBytes": 1073741824
      }
    },
    "RestartPolicy": {
      "Condition": "any",
      "Delay": 30000000000
    },
    "Mode": {
      "Global": {}
    },
    "Networks": [
        {
          "Target": "mg_${NOM_MILLEGRILLE}_net",
          "Aliases": ["mongo", "mongo.local"]
        }
    ]
  },
  "Labels": {
    "millegrille": "${NOM_MILLEGRILLE}"
  }
}
