{
  "Name": "mongoexpress",
  "TaskTemplate": {
    "ContainerSpec": {
      "Image": "${mongoexpress}",
      "Hostname": "mongoexpress.local",
      "Env": [
        "ME_CONFIG_BASICAUTH_USERNAME=mongo",
        "ME_CONFIG_MONGODB_ADMINUSERNAME=${MONGO_INITDB_ROOT_USERNAME}",
        "MONGODB_ADMINPASSWORD_FILE=/run/secrets/mongo.root.password",
        "ME_CONFIG_BASICAUTH_PASSWORD_FILE=/run/secrets/mongoexpress.web.password",
        "VCAP_APP_PORT=443",
        "ME_CONFIG_SITE_SSL_ENABLED='true'",
        "ME_CONFIG_SITE_SSL_CRT_PATH=/run/secrets/pki.millegrilles.ssl.cert",
        "ME_CONFIG_SITE_SSL_KEY_PATH=/run/secrets/pki.millegrilles.ssl.key",
        "ME_CONFIG_MONGODB_SERVER=mongo",
        "ME_CONFIG_MONGODB_SSL=true",
        "ME_CONFIG_MONGODB_KEY=/run/secrets/pki.millegrilles.ssl.key",
        "ME_CONFIG_MONGODB_CERT=/run/secrets/pki.millegrilles.ssl.cert",
        "ME_CONFIG_MONGODB_CACERT=/run/secrets/pki.millegrilles.ssl.CAchain",
        "ME_CONFIG_MONGODB_SSLVALIDATE='true'"
      ],
      "Secrets": [
        {
          "SecretName": "pki.mongoxp.key_cert",
          "File": {
            "Name": "pki.millegrilles.ssl.key_cert",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "SecretName": "passwd.mongoexpress.web",
          "File": {
            "Name": "mongoexpress.web.password",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "SecretName": "passwd.mongo.root",
          "File": {
            "Name": "mongo.root.password",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "SecretName": "pki.mongoxp.key",
          "File": {
            "Name": "pki.millegrilles.ssl.key",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "SecretName": "pki.mongoxp.key",
          "File": {
            "Name": "pki.millegrilles.wadmin.key",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }
      ],
      "Configs": [
        {
          "ConfigName": "pki.mongoxp.cert",
          "File": {
            "Name": "/run/secrets/pki.millegrilles.wadmin.cert",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "ConfigName": "pki.millegrille.fullchain",
          "File": {
            "Name": "/run/secrets/pki.millegrilles.ssl.CAchain",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "ConfigName": "pki.mongoxp.cert",
          "File": {
            "Name": "/run/secrets/pki.millegrilles.ssl.cert",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }
      ],
      "Labels": {
        "ipv6.mapper.network": "mg_ipv6"
      }
    },
    "Placement": {
      "Constraints": [
        "node.labels.netzone.private == true",
        "node.labels.millegrilles.consoles == true"
      ]
    },
    "Resources": {
      "Limits": {
        "NanoCPUs": 500000000,
        "MemoryBytes": 73741824
      }
    },
    "RestartPolicy": {
      "Condition": "any",
      "Delay": 30000000000,
      "MaxAttempts": 10
    },
    "Mode": {
      "Global": {}
    },
    "Networks": [
        {
          "Target": "mg_${IDMG}_net"
        }
    ]
  },
  "EndpointSpec": {
    "Mode": "vip",
    "Ports": [
      {
        "Protocol": "tcp",
        "PublishedPort": 9443,
        "TargetPort": 443,
        "PublishMode": "host"
      }
    ]
  },
  "Labels": {
    "millegrille": "${IDMG}"
  }
}
