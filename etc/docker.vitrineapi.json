{
  "Name": "vitrineapi",
  "TaskTemplate": {
    "ContainerSpec": {
      "Image": "${vitrineapi}",
      "Hostname": "vitrineapi",
      "Env": [
        "MG_IDMG=${IDMG}",
        "WEB_URL=https://vitrineapi-${IDMG}.local",
        "DATA_FOLDER=/var/opt/millegrilles/data",
        "MG_MQ_URL=amqps://mq:5673/${IDMG}",
        "MG_MQ_CAFILE=/run/secrets/pki.millegrilles.ssl.CAchain",
        "MG_MQ_CERTFILE=/run/secrets/pki.millegrilles.ssl.cert",
        "MG_MQ_KEYFILE=/run/secrets/pki.millegrilles.ssl.key",
        "CERT=/run/secrets/pki.millegrilles.ssl.fullchain",
        "PRIVKEY=/run/secrets/pki.millegrilles.ssl.key"
      ],
      "Mounts": [
        {
          "Type": "bind",
          "Source": "/var/opt/millegrilles/${IDMG}/mounts/nginx/data",
          "Target": "/var/opt/millegrilles/data"
        }
      ],
      "Secrets": [
        {
          "SecretName": "pki.vitrineapi.key",
          "File": {
            "Name": "pki.millegrilles.ssl.key",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }
      ],
      "Configs": [
        {
          "ConfigName": "pki.vitrineapi.cert",
          "File": {
            "Name": "/run/secrets/pki.millegrilles.ssl.cert",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        },
        {
          "ConfigName": "pki.millegrille.fullchain",
          "File": {
            "Name": "/run/secrets/pki.millegrilles.ssl.CAchain",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }, {
          "ConfigName": "pki.vitrineapi.fullchain",
          "File": {
            "Name": "/run/secrets/pki.millegrilles.ssl.fullchain",
            "UID": "0",
            "GID": "0",
            "Mode": 292
          }
        }
      ]
    },
    "Placement": {
      "Constraints": [
        "node.labels.millegrilles.vitrine == true"
      ]
    },
    "Resources": {
      "Limits": {
        "NanoCPUs": 1000000000,
        "MemoryBytes": 314572800
      }
    },
    "RestartPolicy": {
      "Condition": "none"
    },
    "Mode": {
      "Replicated": {
        "Replicas": 1
      }
    },
    "Networks": [
        {
          "Target": "mg_${IDMG}_net",
          "Aliases": ["vitrineapi-${IDMG}"]
        }
    ]
  },
  "EndpointSpec": {
    "Mode": "vip",
    "Ports": [
      {
        "Protocol": "tcp",
        "PublishedPort": 6443,
        "TargetPort": 443,
        "PublishMode": "host"
      }
    ]
  },
  "Labels": {
    "millegrille": "${IDMG}"
  }
}
